# üß™ API —Ç–µ—Å—Ç—ã
–î–ª—è API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ NUnit –∏ XUnit. –í –ø–æ–ª–Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å XUnit, –Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –±—ã–ª–æ –ø—Ä–∏–Ω–µ—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—å –∫–æ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å NUnut.
API —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ª–æ—ë–≤ (Repository, Business logic, Net. Core API –∏ Service) –∏ –∫–∞–∂–¥—ã–π —Å–ª–æ–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

## üß™ Unit —Ç–µ—Å—Ç—ã
–û—Å–Ω–æ–≤–Ω—ã–µ —é–Ω–∏—Ç —Ç–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Visual Studio. –õ–∏–±–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—ã 
`dotnet restore` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ `dotnet test` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä [—Ç–µ—Å—Ç](TestRepository) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–æ–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–µ–Ω—å [—Ä–µ—à–µ–Ω–∏—è](https://github.com/JeanRasin/SmartHouse) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `dotnet test SmartHouse.sln`. –¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `dotnet vstest <path\*.dll>...` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä `dotnet vstest Tests\TestRepository\bin\Debug\netcoreapp3.1\RepositoryTest.dll`.
–í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ XUnit –∫—Ä–æ–º–µ [ServicesTest.csproj](https://github.com/JeanRasin/SmartHouse/blob/master/Tests/TestServices/ServicesTest.csproj) –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NUnit.

## ‚öóÔ∏è Integration —Ç–µ—Å—Ç—ã
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç API –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ XUnit –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–π—Å—Ç–≤—É—é—à–∏–π web —Å–µ—Ä–≤–µ—Ä. –ü–æ —ç—Ç–æ–º—É –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –¥–æ–∫–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–≤–∏—Å—ã –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ –∂–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ –¥–æ–∫–µ—Ä–µ. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ç–∞–∫ –∂–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –∫–∞–∫ –∏ —é–Ω–∏—Ç `dotnet vstest Tests\TestApiIntegration\bin\Debug\netcoreapp3.1\ApiIntegrationTest.dll` –ª–∏–±–æ –∏–∑ [–ø–∞–ø–∫–∏](https://github.com/JeanRasin/SmartHouse/tree/master/Tests/TestApiIntegration) —Ç–µ—Å—Ç–∞ –≤–≤–µ—Å—Ç–∏ `dotnet test`. 

## üê≥ Docker
–í –¥–æ–∫–µ—Ä–µ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã. –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∞ –≤–æ—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≥—Ä—É–ø–ø—É —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ API, –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–≥–æ–¥—ã. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –∏–∑ [–∫–æ—Ä–Ω—è](https://github.com/JeanRasin/SmartHouse) —Ä–µ—à–µ–Ω–∏—è.
```docker-compose
docker-compose -f docker-compose.yml -f docker-compose.test.yml up -d
```
–Æ–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–≤–∏–¥–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤—ã–∫–ª—é—á–∞—é—Ç—Å—è.
–î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ–±—Ä–∞–∑–∞ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª [Dockerfile.tests](https://github.com/JeanRasin/SmartHouse/blob/master/Dockerfile.tests) —Å –µ–≥–æ –ø–æ–º–æ—à—å—é –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.
–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ [–∫–æ—Ä–Ω—è](https://github.com/JeanRasin/SmartHouse) —Ä–µ—à–µ–Ω–∏—è.
```docker
docker build -f Dockerfile.tests --rm -t all-test .
```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
```docker
docker run --name all-test_business -d all-test
```
–ò –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç.
```docker
docker exec -it all-test_business bash dotnet vstest TestBusiness/BusinessTest.dll
```
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–∞–∫ –∂–µ, –Ω–æ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ–º–∞–Ω–¥–æ–π, –Ω–æ —É–∂–µ –±–µ–∑ `docker-compose.test.yml` —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–æ–≤.
```docker-compose
docker-compose -f docker-compose.yml up -d
```
–ù–æ —ç—Ç–æ –Ω–µ –≤—Å–µ –Ω–∞—à–µ–º—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω—É–∂–Ω–æ –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—Å—Ç–∏–≤ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π.
```docker
docker run -it --name all-test_integration --network smarthouse_smart-house-network -d all-test
```
 –ò –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
```docker
docker exec -it all-test_business bash dotnet vstest TestApiIntegration/ApiIntegrationTest.dll
```
